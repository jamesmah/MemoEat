
    <!-- Page Header -->
    <div class="row">
        <div class="col-lg-12">
            <h2 class="page-header">
              <% if logged_in? && current_user['username'] == params[:username] %>
                <%= @header_logged_in %>
              <% else %>
                <%= @header %>
              <% end %>
            </h2>
        </div>
    </div>
    <!-- /.row -->

    <!-- Projects Row -->
    <div class="row">

      <% restaurant_count = 0 %>
      <% @restaurants.each do |restaurant| %>
        <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 restaurant-item">
          <input type="hidden" name="id" value="<%= restaurant['id']%>">

          <div class="panel-group">
            <div class="panel panel-default">
              <div class="panel-heading" style="background-image: url(<%= restaurant['photo_url'] %>);" data-toggle="collapse" href="#collapse<%= restaurant['id']%>">
                
                  
                <h4><%= restaurant['name'] %></h4>
                <br>
                <p><%= restaurant['address'] %></p>
                <div class="visible-xs"> </div>
                <img class="visible-xs" src="/images/sort-down.png">
                
              </div>
              <div id="collapse<%= restaurant['id']%>" class="panel-collapse collapse in memo-collapse">
                
                <div class="panel-body">

                  <p style="font-style: italic;"><%= restaurant['cuisines'] %></p>

                  <div></div>
                  <p>Price range</p>
                  <div>
                    <% for i in 1..5 %>
                      <% if !!restaurant['price_range'] &&  i <= restaurant['price_range'] %>
                        <img src="/images/coin2.png">
                      <% else %>
                        <img src="/images/coin1.png">
                      <% end %>
                    <% end %>
                  </div>

                  <div></div>
                  

                  

                  <% if logged_in? && current_user['username'] == params[:username] %>

                    <p>Your rating</p>

                    <div class="rating">
                      <% for i in 1..5 %>
                        <% if !!restaurant['rating'] && i <= restaurant['rating'] %>
                          <form action="/restaurant/<%= restaurant['id'] %>" method="post">
                            <input type="hidden" name="_method" value="patch">
                            <input type="hidden" name="dir" value="<%= @dir %>">
                            <input type="hidden" name="rating" value="<%= i %>">
                            <button style="background-image: url(/images/star2.png);"></button>
                          </form>
                        <% else %>
                          <form action="/restaurant/<%= restaurant['id'] %>" method="post">
                            <input type="hidden" name="_method" value="patch">
                            <input type="hidden" name="dir" value="<%= @dir %>">
                            <input type="hidden" name="rating" value="<%= i %>">
                            <button style="background-image: url(/images/star1.png);"></button>
                          </form>
                        <% end %>
                      <% end %>
                    </div>

                  <% else %>

                    <% user = User.find_by(id: restaurant['user_id']) %>
                    <p><%= user.name %>'s rating</a></p>

                    <div>
                      <% for i in 1..5 %>
                        <% if !!restaurant['rating'] && i <= restaurant['rating'] %>
                          <img src="/images/star2.png">
                        <% else %>
                          <img src="/images/star1.png">
                        <% end %>
                      <% end %>    
                    </div>
                  <% end %>

                  <div></div>
                  <p>Notes</p>


                  <% if logged_in? && current_user['username'] == params[:username] %>
                    <div class="notes">
                      <form action="/restaurant/<%= restaurant['id'] %>" method="post">
                        <input type="hidden" name="dir" value="<%= @dir %>">
                        <input type="hidden" name="_method" value="patch">
                        <textarea name="notes" rows="2"><%= restaurant['notes'] %></textarea>
                        <button>Save</button>
                      </form>
                    </div>

                  <% else %>

                      <textarea name="notes" style="border:none" readonly><%= restaurant['notes'] %></textarea>
                  <% end %>

                  <% if @dir == "browse" %>
                  <div></div>
                  <% user = User.find_by(id: restaurant['user_id']) %>
                  <p>Found by <a href="/<%= user.username %>"><%= user.name %></a></p>
                  <% end %>


                </div>
                <div class="panel-footer">

                  <% if logged_in? && current_user['username'] == params[:username] %>

                    <% if @dir[-8,8] == "/archive"  %>

                      <form action="/restaurant/<%= restaurant['id'] %>" method="post">
                        <input type="hidden" name="_method" value="patch">
                        <input type="hidden" name="dir" value="<%= @dir %>">
                        <input type="hidden" name="archive" value="false">
                        <button class="unarchive-btn">Unarchive</button>
                      </form>

                    <% else %>

                      <form action="/restaurant/<%= restaurant['id'] %>" method="post">
                        <input type="hidden" name="_method" value="patch">
                        <input type="hidden" name="dir" value="<%= @dir %>">
                        <input type="hidden" name="archive" value="true">
                        <button class="archive-btn">Archive</button>
                      </form>

                    <% end %>

                    <form action="/restaurant/<%= restaurant['id'] %>" method="post">
                      <input type="hidden" name="_method" value="delete">
                      <input type="hidden" name="dir" value="<%= @dir %>">
                      <button class="delete-btn">Delete</button>
                    </form>

                    
                  <% else %>

                    
                    <% if logged_in? %>
                    
                      <form class="add-form" action="/restaurant" method="post">
                        <input type="hidden" name="dir" value="<%= @dir %>">
                        <input type="hidden" name="zomato_id" value="<%= restaurant['zomato_id'] %>">
                        <input type="hidden" name="name" value="<%= restaurant['name'] %>">
                        <input type="hidden" name="address" value="<%= restaurant['address'] %>">
                        <input type="hidden" name="cuisines" value="<%= restaurant['cuisines'] %>">
                        <input type="hidden" name="price_range" value="<%= restaurant['price_range'] %>">
                        <input type="hidden" name="photo_url" value="<%= restaurant['photo_url'] %>">
                        <input type="hidden" name="rating" value="<%= restaurant['rating'] %>">
                        <input type="hidden" name="notes" value="<%= restaurant['notes'] %>">

                         <% if !!Restaurant.find_by(user_id: session[:user_id], zomato_id: restaurant['zomato_id'], archive: false) %>
                          <button type="button">Added!</button>
                        <% elsif !!Restaurant.find_by(user_id: session[:user_id], zomato_id: restaurant['zomato_id'], archive: true) %>
                          <button type="button">Archived!</button>
                        <% else %>
                          <button class="add-btn">Add</button>
                        <% end %>
                      </form>

                    <% end %>
                  <% end %>


                </div>
              

              </div>
            </div>
          </div>


        </div>
      
      <% end %>
        

    </div>
